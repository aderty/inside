angular.module("ui.calendar",[]).constant("uiCalendarConfig",{}).directive("uiCalendar",["uiCalendarConfig","$parse",function(n){n=n||{};var t=1,i=1;return{require:"ngModel",scope:{ngModel:"=",config:"="},restrict:"A",link:function(r,u,f){var o=r.ngModel,h,s,c,e;r.destroy=function(){r.calendar=f.calendar?r.$parent[f.calendar]=u.html(""):u.html("")};r.destroy();r.init=function(){var t={eventSources:o};angular.extend(t,n,f.uiCalendar?r.$parent.$eval(f.uiCalendar):{});r.calendar.fullCalendar(t)};r.init();h=function(n,t){var i,f=function(){var i=angular.isFunction(n)?n():n;return i.map(function(n){var i=t(n);return r[i]=n,i})},u=function(n,t){for(var u=[],f={},i=0,r=t.length;i<r;i++)f[t[i]]=!0;for(i=0,r=n.length;i<r;i++)f[n[i]]||u.push(n[i]);return u},r={},e=function(n,f){for(var o,c,v={},y=u(f,n),s,l,a,e=0,h=y.length;e<h;e++)if(s=y[e],o=r[s],delete r[s],l=t(o),l===s)i.onRemoved(o);else{v[l]=s;i.onChanged(o)}for(a=u(n,f),e=0,h=a.length;e<h;e++)if(c=a[e],o=r[c],!v[c])i.onAdded(o)};return i={subscribe:function(n){n.$watch(f,e,!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}};s=h(o,function(n){return n.__id||(n.__id=t++)});s.subscribe(r);s.onAdded=function(n){r.calendar.fullCalendar("addEventSource",n)};s.onRemoved=function(n){r.calendar.fullCalendar("removeEventSource",n)};c=function(){for(var t,i=[],n=0,r=o.length;n<r;n++)t=o[n],angular.isArray(t)&&i.push(t);return Array.prototype.concat.apply([],i)};e=h(c,function(n){return n.__uiCalId||(n.__uiCalId=i++),""+n.__uiCalId+(n.id||"")+(n.title||"")+(n.url||"")+(+n.start||"")+(+n.end||"")+(n.allDay||!1)+(n.className||"")});e.subscribe(r);e.onAdded=function(n){r.calendar.fullCalendar("renderEvent",n)};e.onRemoved=function(n){r.calendar.fullCalendar("removeEvents",function(t){return t===n})};e.onChanged=function(n){r.calendar.fullCalendar("updateEvent",n)}}}}]);