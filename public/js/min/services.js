"use strict";angular.module("inside.services",["ngResource"]).value("version","0.1").factory("LoginService",["$resource","$http","$q","$rootScope",function(n,t,i,r){return{login:function(n,i,r,u){t({method:"POST",url:"/login",data:{email:n,pwd:i,options:r}}).success(function(n){if(n&&n!="false")return u(n);u(!1)}).error(function(){u(!1)})},logout:function(n){t({method:"POST",url:"/logout"}).success(function(t){n(t)}).error(function(t){n(t)})},passwordLost:function(n){var u=i.defer(),f=n.etat==1?"POST":"PUT";return t({method:f,url:"/passwordLost",data:n}).then(function(t){if(t.data.error){r.error=t.data.error;u.reject(t.data.error);return}n.etat==0?n.etat=1:n.etat==1&&(n.etat=2);u.resolve(t.data)},function(n){r.error=n;u.reject(n)}),u.promise}}}]).factory("MotifsService",["$http","$q",function(n,t){var i=null;return{list:function(){var r=t.defer();return i?r.resolve(i):n({method:"GET",url:"/data-conges-motifs"}).then(function(n){i=n.data;r.resolve(i)}),r.promise}}}]).factory("ContactService",["$http","$q","$rootScope",function(n,t,i){return{send:function(r){var u=t.defer();return n({method:"POST",url:"/contact",data:r}).then(function(n){if(n&&n.data.error){i.error=n.data.error;u.reject(n.data.error);return}u.resolve(n.data)},function(n){i.error=n;u.reject(n)}),u.promise}}}]).factory("HistoryService",["$http","$q","$rootScope",function(n,t,i){return{list:function(r){var u=t.defer();return n({method:"POST",url:"/data-history",data:{user:r}}).then(function(n){if(n&&n.data.error){i.error=n.data.error;u.reject(n.data.error);return}u.resolve(n.data)},function(n){i.error=n;u.reject(n)}),u.promise}}}]).factory("UsersService",["$resource","$q","$rootScope",function(n,t,i){var r=n("/data-users/:id",{id:"@id"},{charge:{method:"POST",params:{charge:!0}},changePassword:{method:"PUT",params:{password:!0}},searcher:{method:"GET",params:{search:!0},isArray:!0}});return r.search=function(n){var i=t.defer(),u=r.searcher(n,function(){i.resolve(u)});return i.promise},r.password=function(n){var u=t.defer();return r.changePassword(n,function(n){if(n.error){i.error=n.error;u.reject(n.error);return}u.resolve(n)},function(n){i.error=n;u.reject(n)}),u.promise},r}]).factory("CongesService",["$resource","$q","$rootScope",function(n,t,i){function u(n){return n.debut.date.setHours(0),n.debut.type==1&&n.debut.date.setHours(12),n.fin.date.setHours(22),n.fin.type==0&&n.fin.date.setHours(12),n.debut=n.debut.date,n.fin=n.fin.date,n.user&&n.user.id&&(n.nom=n.user.nom,n.prenom=n.user.prenom,n.user=n.user.id),n}var r=n("/data-conges/:id",{id:"@id"},{create:{method:"POST",params:{creation:!0}}});return{list:function(n){var u=t.defer(),i=r.query(n,function(){for(var n=0,t=i.length;n<t;n++)i[n].creation=new Date(i[n].creation),i[n].debut={date:new Date(i[n].debut),type:new Date(i[n].debut).getHours()<8?0:1},i[n].fin={date:new Date(i[n].fin),type:new Date(i[n].fin).getHours()>14?1:0},i[n].user&&(i[n].user={nom:i[n].nom,prenom:i[n].prenom,id:i[n].user},delete i[n].nom,delete i[n].prenom);u.resolve(i)});return u.promise},save:function(n,f){var e=t.defer();return f&&(n.create=!0),r.save(u(n),function(t){if(t.error){i.error=t.error;e.reject(t.error);return}n.user={nom:n.nom,prenom:n.prenom,id:n.user};e.resolve(t)},function(n){i.error=reponse;e.reject(n)}),e.promise},remove:function(n){var f=t.defer();return r.remove(u(n),function(n){if(n.error){i.error=n.error;f.reject(n.error);return}f.resolve(n)},function(n){i.error=reponse;f.reject(n)}),f.promise}}}]).factory("CongesAdminService",["$resource","$q","$rootScope","$filter",function(n,t,i,r){function f(n){return n.typeuser==2&&(n.user={id:999999,nom:"Tous",prenom:""}),delete n.typeuser,n.debut.date.setHours(0),n.debut.type==1&&n.debut.date.setHours(12),n.fin.date.setHours(22),n.fin.type==0&&n.fin.date.setHours(12),n.debut=n.debut.date,n.fin=n.fin.date,n.user&&n.user.id&&(n.nom=n.user.nom,n.prenom=n.user.prenom,n.user=n.user.id),n}var u=n("/data-admin-conges/:id",{id:"@id"},{create:{method:"POST",params:{create:!0}},updateEtat:{method:"POST",params:{etat:!0}}});return{list:function(n){var r=t.defer(),i=u.query(n,function(){for(var n=0,t=i.length;n<t;n++)i[n].creation=new Date(i[n].creation),i[n].debut={date:new Date(i[n].debut),type:new Date(i[n].debut).getHours()<8?0:1},i[n].fin=i[n].fin={date:new Date(i[n].fin),type:new Date(i[n].fin).getHours()>14?1:0},i[n].user&&(i[n].user={nom:i[n].nom,prenom:i[n].prenom,id:i[n].user},delete i[n].nom,delete i[n].prenom,i[n].typeuser=i[n].user.id==999999?2:1);r.resolve(i)});return r.promise},save:function(n,r){var e=t.defer();return r&&(n.create=!0),u.save(f(n),function(t){if(t.error){i.error=t.error;e.reject(t.error);return}n.user={nom:n.nom,prenom:n.prenom,id:n.user};e.resolve(t)},function(n){i.error=n;e.reject(n)}),e.promise},remove:function(n){var r=t.defer();return u.remove(f(n),function(n){if(n.error){i.error=n.error;r.reject(n.error);return}r.resolve(n)},function(n){i.error=n;r.reject(n)}),r.promise},updateEtat:function(n){var e=t.defer();return n.libelle=r("motifConges")(n.motif),u.updateEtat(f(n),function(n){if(n.error){i.error=n.error;e.reject(n.error);return}e.resolve(n)},function(n){i.error=n;e.reject(n)}),e.promise}}}]).factory("ActiviteService",["$resource","$q","$rootScope",function(n,t,i){var r=n("/data-activite/:mois",{id:"@mois"},{list:{method:"GET"},create:{method:"POST",params:{create:!0}},updateEtat:{method:"POST",params:{etat:!0}}});return{list:function(n){var u=t.defer(),i=r.list(n,function(){var r,t,f,e;for(r=n.start.getDate()==1?new Date(n.start.getFullYear(),n.start.getMonth(),1):new Date(n.start.getFullYear(),n.start.getMonth()+1,1),i.mois?(i.mois=new Date(i.mois),i.mois.getMonth()!=r.getMonth()&&(i.etat=-1,i.activite=[])):i.mois=r,t=0,f=i.activite.length;t<f;t++)i.activite[t].jour?(i.activite[t].jour={date:new Date(i.activite[t].jour),type:new Date(i.activite[t].jour).getHours()<8?0:1},i.activite[t].duree=i.activite[t].jour.date.getHours()==0?0:i.activite[t].jour.date.getHours()<14?1:2):(i.activite[t].debut={date:new Date(i.activite[t].debut),type:new Date(i.activite[t].debut).getHours()<8?0:1},i.activite[t].fin={date:new Date(i.activite[t].fin),type:new Date(i.activite[t].fin).getHours()>14?1:0}),e=["JT1","JT2","JT3","FOR","INT","WK","JF","CP","CP_ANT","RTT"],i.activite[t].type=="JF"&&i.activite[t].debut&&i.activite[t].fin&&(i.activite[t].debut.date.setHours(0),i.activite[t].debut.date.setMinutes(0),i.activite[t].fin.date.setHours(0),i.activite[t].fin.date.setMinutes(0),i.activite[t].debut.type=0,i.activite[t].fin.type=1);u.resolve(i)});return u.promise},save:function(n,u){var f=t.defer();return u&&(n.create=!0),r.save(n,function(n){if(n.error){i.error=n.error;f.reject(n.error);return}f.resolve(n)},function(n){i.error=n;f.reject(n)}),f.promise}}}]).factory("ActiviteAdminService",["$resource","$q","$rootScope",function(n,t,i){var r=n("/data-admin-activite/:id",{id:"@id"},{list:{method:"GET",isArray:!0},listSans:{method:"GET",params:{sans:!0},isArray:!0},removeActivite:{method:"DELETE"},create:{method:"POST",params:{create:!0}},updateEtat:{method:"POST",params:{etat:!0}}});return{list:function(n){var u=t.defer(),i=r.list(n,function(){for(var n=0,t=i.length;n<t;n++)i[n].mois&&(i[n].mois=new Date(i[n].mois)),i[n].user&&(i[n].user={nom:i[n].nom,prenom:i[n].prenom,id:i[n].user},delete i[n].nom,delete i[n].prenom);u.resolve(i)});return u.promise},listSans:function(n){var u=t.defer(),i=r.listSans(n,function(){for(var n=0,t=i.length;n<t;n++)i[n].user={id:i[n].id,nom:i[n].nom,prenom:i[n].prenom},i[n].mois&&(i[n].mois=new Date(i[n].mois));u.resolve(i)});return u.promise},get:function(n){var f={id:n.user.id,start:n.mois,end:moment(n.mois).add("month",1).toDate()},u=t.defer(),i=r.get(f,function(){var n,t,r;for(i.mois&&(i.mois=new Date(i.mois)),n=0,t=i.activite.length;n<t;n++)i.activite[n].jour?(i.activite[n].jour={date:new Date(i.activite[n].jour),type:new Date(i.activite[n].jour).getHours()<8?0:1},i.activite[n].duree=i.activite[n].jour.date.getHours()==0?0:i.activite[n].jour.date.getHours()<14?1:2):(i.activite[n].debut={date:new Date(i.activite[n].debut),type:new Date(i.activite[n].debut).getHours()<8?0:1},i.activite[n].fin={date:new Date(i.activite[n].fin),type:new Date(i.activite[n].fin).getHours()>14?1:0}),r=["JT1","JT2","JT3","FOR","INT","WK","JF","CP","CP_ANT","RTT"],i.activite[n].type=="JF"&&i.activite[n].debut&&i.activite[n].fin&&(i.activite[n].debut.date.setHours(0),i.activite[n].debut.date.setMinutes(0),i.activite[n].fin.date.setHours(0),i.activite[n].fin.date.setMinutes(0),i.activite[n].debut.type=0,i.activite[n].fin.type=1);u.resolve(i)});return u.promise},remove:function(n){var u=t.defer();return n={user:n.user.id,mois:n.mois,etat:n.etat},r.removeActivite(n,function(n){if(n.error){i.error=n.error;u.reject(n.error);return}u.resolve(n)},function(n){i.error=n;u.reject(n)}),u.promise},updateEtat:function(n){var u=t.defer();return n.user&&(n.user=n.user.id),r.updateEtat(n,function(n){if(n.error){i.error=n.error;u.reject(n.error);return}u.resolve(n)},function(n){i.error=n;u.reject(n)}),u.promise},save:function(n,u){var f=t.defer();return u&&(n.create=!0),n.user&&(n.user=n.user.id),r.save(n,function(n){if(n.error){i.error=n.error;f.reject(n.error);return}f.resolve(n)},function(n){i.error=n;f.reject(n)}),f.promise}}}]);