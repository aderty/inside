"use strict";angular.module("inside.services",["ngResource"]).value("version","0.1").factory("LoginService",["$resource","$http","$q","$rootScope",function(c,d,b,a){return{login:function(f,g,e,h){d({method:"POST",url:"/login",data:{email:f,pwd:g,options:e}}).success(function(k,i,l,j){if(k&&k!="false"){return h(k)}h(false)}).error(function(k,i,l,j){h(false)})},logout:function(e){d({method:"POST",url:"/logout"}).success(function(h,f,i,g){e(h)}).error(function(h,f,i,g){e(h)})},passwordLost:function(e){var f=b.defer();var g=e.etat==1?"POST":"PUT";d({method:g,url:"/passwordLost",data:e}).then(function(h){if(h.data.error){a.error=h.data.error;f.reject(h.data.error);return}if(e.etat==0){e.etat=1}else{if(e.etat==1){e.etat=2}}f.resolve(h.data)},function(h){a.error=h;f.reject(h)});return f.promise}}}]).factory("MotifsService",["$http","$q",function(c,b){var a=null;return{list:function(){var d=b.defer();if(a){d.resolve(a)}else{c({method:"GET",url:"/data-conges-motifs"}).then(function(e){a=e.data;d.resolve(a)})}return d.promise}}}]).factory("ContactService",["$http","$q","$rootScope",function(d,c,b){var a=null;return{send:function(f){var e=c.defer();d({method:"POST",url:"/contact",data:f}).then(function(g){if(g&&g.data.error){b.error=g.data.error;e.reject(g.data.error);return}e.resolve(g.data)},function(g){b.error=g;e.reject(g)});return e.promise}}}]).factory("HistoryService",["$http","$q","$rootScope",function(d,c,b){var a=null;return{list:function(e){var f=c.defer();d({method:"POST",url:"/data-history",data:{user:e}}).then(function(g){if(g&&g.data.error){b.error=g.data.error;f.reject(g.data.error);return}f.resolve(g.data)},function(g){b.error=g;f.reject(g)});return f.promise}}}]).factory("UsersService",["$resource","$q","$rootScope",function(c,b,a){var d=c("/data-users/:id",{id:"@id"},{charge:{method:"POST",params:{charge:true}},changePassword:{method:"PUT",params:{password:true}},searcher:{method:"GET",params:{search:true},isArray:true}});d.search=function(e){var f=b.defer();var g=d.searcher(e,function(){f.resolve(g)});return f.promise};d.password=function(e){var f=b.defer();d.changePassword(e,function(g){if(g.error){a.error=g.error;f.reject(g.error);return}f.resolve(g)},function(g){a.error=g;f.reject(g)});return f.promise};return d}]).factory("CongesService",["$resource","$q","$rootScope",function(d,b,a){var e=d("/data-conges/:id",{id:"@id"},{create:{method:"POST",params:{creation:true}}});function c(f){f.debut.date.setHours(0);if(f.debut.type==1){f.debut.date.setHours(12)}f.fin.date.setHours(22);if(f.fin.type==0){f.fin.date.setHours(12)}f.debut=f.debut.date;f.fin=f.fin.date;if(f.user&&f.user.id){f.nom=f.user.nom;f.prenom=f.user.prenom;f.user=f.user.id}return f}return{list:function(g){var h=b.defer();var f=e.query(g,function(){for(var k=0,j=f.length;k<j;k++){f[k].creation=new Date(f[k].creation);f[k].debut={date:new Date(f[k].debut),type:new Date(f[k].debut).getHours()<8?0:1};f[k].fin={date:new Date(f[k].fin),type:new Date(f[k].fin).getHours()>14?1:0};if(f[k].user){f[k].user={nom:f[k].nom,prenom:f[k].prenom,id:f[k].user};delete f[k].nom;delete f[k].prenom}}h.resolve(f)});return h.promise},save:function(g,f){var h=b.defer();if(f){g.create=true}e.save(c(g),function(i){if(i.error){a.error=i.error;h.reject(i.error);return}g.user={nom:g.nom,prenom:g.prenom,id:g.user};h.resolve(i)},function(i){a.error=reponse;h.reject(i)});return h.promise},remove:function(f){var g=b.defer();e.remove(c(f),function(h){if(h.error){a.error=h.error;g.reject(h.error);return}g.resolve(h)},function(h){a.error=reponse;g.reject(h)});return g.promise}}}]).factory("CongesAdminService",["$resource","$q","$rootScope","$filter",function(d,b,a,f){var e=d("/data-admin-conges/:id",{id:"@id"},{create:{method:"POST",params:{create:true}},updateEtat:{method:"POST",params:{etat:true}}});function c(g){if(g.typeuser==2){g.user={id:999999,nom:"Tous",prenom:""}}delete g.typeuser;g.debut.date.setHours(0);if(g.debut.type==1){g.debut.date.setHours(12)}g.fin.date.setHours(22);if(g.fin.type==0){g.fin.date.setHours(12)}g.debut=g.debut.date;g.fin=g.fin.date;if(g.user&&g.user.id){g.nom=g.user.nom;g.prenom=g.user.prenom;g.user=g.user.id}return g}return{list:function(h){var i=b.defer();var g=e.query(h,function(){for(var k=0,j=g.length;k<j;k++){g[k].creation=new Date(g[k].creation);g[k].debut={date:new Date(g[k].debut),type:new Date(g[k].debut).getHours()<8?0:1};g[k].fin=g[k].fin={date:new Date(g[k].fin),type:new Date(g[k].fin).getHours()>14?1:0};if(g[k].user){g[k].user={nom:g[k].nom,prenom:g[k].prenom,id:g[k].user};delete g[k].nom;delete g[k].prenom;g[k].typeuser=g[k].user.id==999999?2:1}}i.resolve(g)});return i.promise},save:function(h,g){var i=b.defer();if(g){h.create=true}e.save(c(h),function(j){if(j.error){a.error=j.error;i.reject(j.error);return}h.user={nom:h.nom,prenom:h.prenom,id:h.user};i.resolve(j)},function(j){a.error=j;i.reject(j)});return i.promise},remove:function(g){var h=b.defer();e.remove(c(g),function(i){if(i.error){a.error=i.error;h.reject(i.error);return}h.resolve(i)},function(i){a.error=i;h.reject(i)});return h.promise},updateEtat:function(g){var h=b.defer();g.libelle=f("motifConges")(g.motif);e.updateEtat(c(g),function(i){if(i.error){a.error=i.error;h.reject(i.error);return}h.resolve(i)},function(i){a.error=i;h.reject(i)});return h.promise}}}]).factory("ActiviteService",["$resource","$q","$rootScope",function(c,b,a){var d=c("/data-activite/:mois",{id:"@mois"},{list:{method:"GET"},create:{method:"POST",params:{create:true}},updateEtat:{method:"POST",params:{etat:true}}});return{list:function(e){var f=b.defer();var g=d.list(e,function(){var m;if(e.start.getDate()==1){m=new Date(e.start.getFullYear(),e.start.getMonth(),1)}else{m=new Date(e.start.getFullYear(),e.start.getMonth()+1,1)}if(g.mois){g.mois=new Date(g.mois);if(g.mois.getMonth()!=m.getMonth()){g.etat=-1;g.activite=[]}}else{g.mois=m}for(var k=0,h=g.activite.length;k<h;k++){if(g.activite[k].jour){g.activite[k].jour={date:new Date(g.activite[k].jour),type:new Date(g.activite[k].jour).getHours()<8?0:1};if(g.activite[k].jour.date.getHours()==0){g.activite[k].duree=0}else{if(g.activite[k].jour.date.getHours()<14){g.activite[k].duree=1}else{g.activite[k].duree=2}}}else{g.activite[k].debut={date:new Date(g.activite[k].debut),type:new Date(g.activite[k].debut).getHours()<8?0:1};g.activite[k].fin={date:new Date(g.activite[k].fin),type:new Date(g.activite[k].fin).getHours()>14?1:0}}var j=["JT1","JT2","JT3","FOR","INT","WK","JF","CP","CP_ANT","RTT"];if(g.activite[k].type=="JF"&&g.activite[k].debut&&g.activite[k].fin){g.activite[k].debut.date.setHours(0);g.activite[k].debut.date.setMinutes(0);g.activite[k].fin.date.setHours(0);g.activite[k].fin.date.setMinutes(0);g.activite[k].debut.type=0;g.activite[k].fin.type=1}}f.resolve(g)});return f.promise},save:function(g,e){var f=b.defer();if(e){g.create=true}d.save(g,function(h){if(g.create){delete g.create}if(h.error){a.error=h.error;f.reject(h.error);return}f.resolve(h)},function(h){a.error=h;f.reject(h)});return f.promise}}}]).factory("ActiviteAdminService",["$resource","$q","$rootScope",function(c,b,a){var d=c("/data-admin-activite/:id",{id:"@id"},{list:{method:"GET",isArray:true},listSans:{method:"GET",params:{sans:true},isArray:true},removeActivite:{method:"DELETE"},create:{method:"POST",params:{create:true}},updateEtat:{method:"POST",params:{etat:true}}});return{list:function(e){var g=b.defer();var f=d.list(e,function(){for(var j=0,h=f.length;j<h;j++){if(f[j].mois){f[j].mois=new Date(f[j].mois)}if(f[j].user){f[j].user={nom:f[j].nom,prenom:f[j].prenom,id:f[j].user};delete f[j].nom;delete f[j].prenom}}g.resolve(f)});return g.promise},listSans:function(e){var g=b.defer();var f=d.listSans(e,function(){for(var j=0,h=f.length;j<h;j++){f[j].user={id:f[j].id,nom:f[j].nom,prenom:f[j].prenom};if(f[j].mois){f[j].mois=new Date(f[j].mois)}}g.resolve(f)});return g.promise},get:function(e){var h={id:e.user.id,start:e.mois,end:moment(e.mois).add("month",1).toDate()};var f=b.defer();var g=d.get(h,function(){if(g.mois){g.mois=new Date(g.mois)}for(var m=0,j=g.activite.length;m<j;m++){if(g.activite[m].jour){g.activite[m].jour={date:new Date(g.activite[m].jour),type:new Date(g.activite[m].jour).getHours()<8?0:1};if(g.activite[m].jour.date.getHours()==0){g.activite[m].duree=0}else{if(g.activite[m].jour.date.getHours()<14){g.activite[m].duree=1}else{g.activite[m].duree=2}}}else{g.activite[m].debut={date:new Date(g.activite[m].debut),type:new Date(g.activite[m].debut).getHours()<8?0:1};g.activite[m].fin={date:new Date(g.activite[m].fin),type:new Date(g.activite[m].fin).getHours()>14?1:0}}var k=["JT1","JT2","JT3","FOR","INT","WK","JF","CP","CP_ANT","RTT"];if(g.activite[m].type=="JF"&&g.activite[m].debut&&g.activite[m].fin){g.activite[m].debut.date.setHours(0);g.activite[m].debut.date.setMinutes(0);g.activite[m].fin.date.setHours(0);g.activite[m].fin.date.setMinutes(0);g.activite[m].debut.type=0;g.activite[m].fin.type=1}}f.resolve(g)});return f.promise},remove:function(f){var e=b.defer();f={user:f.user.id,mois:f.mois,etat:f.etat};d.removeActivite(f,function(g){if(g.error){a.error=g.error;e.reject(g.error);return}e.resolve(g)},function(g){a.error=g;e.reject(g)});return e.promise},updateEtat:function(f){var e=b.defer();if(f.user){f.user=f.user.id}d.updateEtat(f,function(g){if(g.error){a.error=g.error;e.reject(g.error);return}e.resolve(g)},function(g){a.error=g;e.reject(g)});return e.promise},save:function(g,e){var f=b.defer();if(e){g.create=true}if(g.user){g.user=g.user.id}d.save(g,function(h){if(g.create){delete g.create}if(h.error){a.error=h.error;f.reject(h.error);return}f.resolve(h)},function(h){a.error=h;f.reject(h)});return f.promise}}}]);