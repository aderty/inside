"use strict";(function(){function n(n,t,i,r,u){n.edition=0;n.mode="";n.lblMode="";n.currentConges={};n.currentCongesSaved=null;n.motifsConges=angular.copy(t.motifsConges);for(var f=0,e=n.motifsConges.length;f<e;f++)if(n.motifsConges[f].id=="RCE"){n.motifsConges.splice(f,1);break}n.showMatricule=!1;n.dateOptionsDebut={dateFormat:"dd/mm/yy",changeYear:!0,changeMonth:!0,yearRange:"0:+1Y",minDate:"0"};n.dateOptionsFin={dateFormat:"dd/mm/yy",changeYear:!0,changeMonth:!0,yearRange:"0:+1Y",minDate:"0"};n.$watch("currentConges.debut.date",function(t){n.dateOptionsFin.minDate=t});n.user=r.get({id:0},function(t){n.cp=t.cp;n.cp_ant=t.cp_ant;n.rtt=t.rtt});n.showAide=function(){var n=i.dialog({backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"/templates/aide-conges.html",controller:"DialogAideConges"});n.open()};n.create=function(){t.error=null;n.editConges.$setPristine();n.currentConges={etat:1,debut:{type:0},fin:{type:1}};n.edition=1;n.mode="Création";n.lblMode="Nouvelle demande de congés"};n.cancel=function(){t.error=null;n.edition=0;$.extend(n.currentConges,n.currentCongesSaved)};n.edit=function(i){t.error=null;n.currentConges=i;n.editConges.$setPristine();n.currentCongesSaved=angular.copy(n.currentConges);n.edition=2;n.mode="Edition";n.lblMode="Modification d'une demande de congés"};n["delete"]=function(f){var e=i.messageBox("Suppression d'un congé","Etes-vous sûr de supprimer la demande de congés ?",[{label:"Oui",result:"yes",cssClass:"btn-primary"},{label:"Non",result:"no"}]);e.open().then(function(i){i==="yes"&&u.remove(f).then(function(){t.error=null;var i=t.conges.indexOf(f);t.conges.splice(i,1);n.user=r.get({id:0},function(t){n.cp=t.cp;n.cp_ant=t.cp_ant;n.rtt=t.rtt})})})};n.isEditable=function(n){return moment(n.creation).add("days",1)>moment()&&n.etat==1};n.isUnchanged=function(t){n.haschanged=angular.equals(t,n.currentCongesSaved);return};n.save=function(i){var f=angular.copy(i);delete f.etat;n.edition==1&&(f.create=!0);u.save(f,n.edition==1).then(function(u){t.error=null;n.edition==1&&t.infos.nbCongesVal++;n.edition=0;u.id&&(i.id=u.id);u.duree&&(i.duree=u.duree);var f=t.conges.indexOf(i);f==-1&&t.conges.push(i);n.user=r.get({id:0},function(t){n.cp=t.cp;n.cp_ant=t.cp_ant;n.rtt=t.rtt})})};n.selectUserOptions={query:function(n){n.callback({more:!1,results:[]})},initSelection:function(){}}}function t(n,t){n.close=function(){t.close()}}function i(){}function r(n,t,i,r,u,f){n.filterOptions={filterText:"",useExternalFilter:!1,filterRow:{etat:2}};n.pagingOptions={pageSizes:[25,50,100],pageSize:50,totalServerItems:0,currentPage:1};var e=!0;t.conges=[];n.updateFilter=function(){e=!e;t.tableParamsConges.reload();t.tableParamsConges.page(1)};t.tableParamsConges=new r({page:1,count:10,sorting:{"debut.date":"asc"}},{getData:function(n,i){f.list({past:e}).then(function(r){t.conges=u(r,i);n.resolve(t.conges)})}})}this.register("CongesMain",["$scope","$rootScope","$dialog","UsersService","CongesService",n]);this.register("DialogAideConges",["$scope","dialog",t]);this.register("CongesGauges",["$scope","$rootScope",i]);this.register("CongesGrid",["$scope","$rootScope","$filter","ngTableParams","ngTableFilter","CongesService","$timeout",r])}).call(app.controllerProvider);