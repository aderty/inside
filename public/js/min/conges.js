"use strict";(function(){this.register("CongesMain",["$scope","$rootScope","$dialog","UsersService","CongesService",f]);this.register("DialogAideConges",["$scope","dialog",g]);this.register("CongesGauges",["$scope","$rootScope",e]);this.register("CongesGrid",["$scope","$rootScope","$filter","ngTableParams","ngTableFilter","CongesService","$timeout",h]);function f(d,n,b,a,i){d.edition=0;d.mode="";d.lblMode="";d.currentConges={};d.currentCongesSaved=null;d.placeholderDate=moment().format("DD/MM/YYYY");d.motifsConges=angular.copy(n.motifsConges);for(var c=0,l=d.motifsConges.length;c<l;c++){if(d.motifsConges[c].id=="RCE"){d.motifsConges.splice(c,1);break}}d.showMatricule=false;d.dateOptionsDebut={dateFormat:"dd/mm/yy",changeYear:true,changeMonth:true,yearRange:"0:+1Y",minDate:"0"};d.dateOptionsFin={dateFormat:"dd/mm/yy",changeYear:true,changeMonth:true,yearRange:"0:+1Y",minDate:"0"};d.$watch("currentConges.debut.date",function(j){d.dateOptionsFin.minDate=j});a.get({id:0},function(j){d.user=j;d.cp=j.cp;d.cp_ant=j.cp_ant;d.rtt=j.rtt});d.showAide=function(){var j=b.dialog({backdrop:true,keyboard:true,backdropClick:true,templateUrl:"/templates/aide-conges.html?v="+config.version,controller:"DialogAideConges"});j.open()};d.create=function(){n.error=null;d.editConges.$setPristine();d.currentConges={etat:1,debut:{type:0},fin:{type:1}};d.edition=1;d.mode="Création";d.lblMode="Nouvelle demande d'absence"};d.cancel=function(){n.error=null;d.edition=0;$.extend(d.currentConges,d.currentCongesSaved)};d.edit=function(j){n.error=null;d.currentConges=j;d.editConges.$setPristine();d.currentCongesSaved=angular.copy(d.currentConges);d.edition=2;d.mode="Edition";d.lblMode="Modification d'une demande d'absence"};d["delete"]=function(m){var j=[{label:"Oui",result:"yes",cssClass:"btn-primary"},{label:"Non",result:"no"}];var k=b.messageBox("Suppression d'une absence","Etes-vous sûr de supprimer la demande d'absence ?",j);k.open().then(function(p){if(p==="yes"){i.remove(m).then(function(o){n.error=null;var r=n.conges.indexOf(m);n.conges.splice(r,1);a.get({id:0},function(q){d.cp=q.cp;d.cp_ant=q.cp_ant;d.rtt=q.rtt})})}})};d.isEditable=function(j){return moment(j.creation).add("days",2)>moment()&&j.etat==1};d.isUnchanged=function(j){d.haschanged=angular.equals(j,d.currentCongesSaved);return};d.save=function(j){var k=angular.copy(j);delete k.etat;if(d.edition==1){k.create=true}i.save(k,d.edition==1).then(function(m){n.error=null;if(d.edition==1){n.infos.nbCongesVal++}d.edition=0;if(m.id){j.id=m.id}if(m.duree){j.duree=m.duree}var p=n.conges.indexOf(j);if(p==-1){n.conges.push(j)}a.get({id:0},function(o){d.cp=o.cp;d.cp_ant=o.cp_ant;d.rtt=o.rtt})})};d.selectUserOptions={query:function(j){j.callback({more:false,results:[]})},initSelection:function(j,m,k){}}}function g(b,a){b.close=function(){a.close()}}function e(a,b){}function h(b,d,n,r,o,a,q){b.filterOptions={filterText:"",useExternalFilter:false,filterRow:{etat:2}};b.pagingOptions={pageSizes:[25,50,100],pageSize:50,totalServerItems:0,currentPage:1};var p;var c=true;d.conges=[];b.updateFilter=function(i){c=!c;d.tableParamsConges.reload();d.tableParamsConges.page(1)};d.tableParamsConges=new r({page:1,count:10,sorting:{"debut.date":"asc"}},{getData:function(j,i){a.list({past:c}).then(function(k){d.conges=o(k,i);j.resolve(d.conges)})}})}}).call(app.controllerProvider);